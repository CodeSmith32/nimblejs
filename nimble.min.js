var nimble=new function(){"use strict";var e,n,t,i,o,a=this,r=(o=navigator.userAgent,n="edge",(e=o.match(/(?:Edge\/((\d+)[\d\.]*))/))||(n="chrome",e=o.match(/Chrome\/((\d+)[\d\.]*)/))||(n="firefox",e=o.match(/Firefox\/((\d+)[\d\.]*)/))||(n="ie",e=o.match(/(?:MSIE |Trident.*?rv:?\s*)((\d+)[\d\.]*)/))||(n="opera",e=o.match(/(?:Opera |Opera\/.*?Version )((\d+)[\d\.]*)/))||(n="safari",e=o.match(/(?:Version\/((\d+)[\d\.]*))?.*Safari/))||(n="other",0)?(t=e[2],i=e[1]):(t=null,i=null),{browser:n,version:+t,fullversion:i,valueOf:function(){return n}}),l="requestAnimationFrame"in window?"":"msRequestAnimationFrame"in window?"ms":"mozRequestAnimationFrame"in window?"moz":"webkitRequestAnimationFrame"in window?"webkit":"oRequestAnimationFrame"in window?"o":"",c=l+(l?"R":"r")+"equestAnimationFrame",s=l+(l?"C":"c")+"ancelAnimationFrame",f="pointerLockElement"in document?"":"msPointerLockElement"in document?"ms":"mozPointerLockElement"in document?"moz":"webkitPointerLockElement"in document?"webkit":"",d=f+(f?"R":"r")+"equestPointerLock",u=f+(f?"E":"e")+"xitPointerLock",m=f+(f?"P":"p")+"ointerLockElement",h=f+"pointerlockchange",v=f+"pointerlockerror";function p(e,n){return e.hook=function(e,t){"function"==typeof t&&e in n&&n[e].push(t)},e.unhook=function(e,t){if(e in n){var i=n[e].indexOf(t);i>-1&&n[e].splice(i,1)}},function(e){for(var t=n[e],i=t.length,o=0;o<i;o++)t[o].apply(void 0,arguments)}}function w(e,n,t){var i=!1;e.enable=function(){if(!i){var e;for(var o in t){e=o.split(" ");for(var a=0;a<e.length;a++)n.addEventListener(e[a],t[o])}i=!0}},e.disable=function(){if(i){var e;for(var o in t){e=o.split(" ");for(var a=0;a<e.length;a++)n.removeEventListener(e[a],t[o])}i=!1}},e.isenabled=function(){return i},a.enableByDefault&&e.enable()}a.enableByDefault=!0;var x=function(e){var n=this;if(!(n instanceof x))throw"Bad instantiation of object nimble.Canvas";e=e||window;var t,i,o=null,a="2d",r=null;function l(l){o&&o.getContext&&(n.width=t=o.width=e.innerWidth||e.offsetWidth,n.height=i=o.height=e.innerHeight||e.offsetHeight,r=o.getContext(a),n.antialiasing||(r.imageSmoothingEnabled=!1),n.context=r,c("resize",t,i,l),n.redraw())}n.context=null,n.width=0,n.height=0,n.antialias=!0,w(n,window,{resize:l}),n.update=function(){l(null)},n.canvas=function(e,n){if(void 0===e)return o;o=e,a=3==n?"webgl":"2d",l()},n.stepclear=function(){n.clear()},n.clear=function(e){e||(e=n.back),e?(r.fillStyle=e,r.fillRect(-1,-1,t+2,i+2)):r.clearRect(-1,-1,t+2,i+2)},n.redraw=function(){c("draw",r,t,i)},n.back=null;var c=p(n,{draw:[],resize:[]})},y=function(e){var n=this;if(!(n instanceof y))throw"Bad instantiation of object nimble.Steps";e=e||window;var t=null,i=30,o=!1;function a(){o&&(r("step",i),t=window[c](a))}n.enable=n.start=function(e){null===t&&(+e===e&&(i=Math.max(1,e)),t=window[c](a),o=!0)},n.disable=n.stop=function(){null!==t&&(window[s](t),t=null,o=!1)},n.fps=function(e){if(+e!==e)return i;i=Math.max(e)};var r=p(n,{step:[]})},b=function(e){var n=this;if(!(n instanceof b))throw"Bad instantiation of object nimble.Keyboard";e=e||window;var t=function(){for(var e={backspace:8,tab:9,numclear:12,enter:13,shift:16,control:17,alt:18,space:32,pageup:33,pagedown:34,end:35,home:36,
left:37,up:38,right:39,down:40,pausebreak:19,capslock:20,escape:27,printscreen:44,insert:45,del:46,windows:91,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimal:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,colon:186,plus:187,equals:187,comma:188,lessthan:188,period:190,greaterthan:190,minus:189,underscore:189,slash:191,question:191,atilda:192,lbracket:219,rbracket:221,quote:222,backslash:220,verticalbar:220},n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",t=0;t<n.length;t++)e[n[t]]=n.charCodeAt(t);return e}(),i={};for(var o in t)n[o]=!1,i[t[o]]=o;n.codes=Object.create(t),n.icodes=Object.create(i),n.pressed={},n.released={},w(n,e,{keydown:function(e){var t=i[e.which];n[t]||(n[t]=!0,n.steps&&(n.pressed[t]=!0),a("down",e.which,t,e))},keyup:function(e){var t=i[e.which];n[t]=!1,n.steps&&(n.released[t]=!0),a("up",e.which,t,e)}}),n.stepclear=function(){n.pressed={},n.released={}},n.steps=!1;var a=p(n,{down:[],up:[]})},z=function(e){var n=this;if(!(n instanceof z))throw"Bad instantiation of object nimble.Mouse";e=e||window;var t=d in e?e:document.documentElement,i={left:1,middle:2,right:3},o={};for(var a in i)n[a]=!1,o[i[a]]=a;n.codes=Object.create(i),n.icodes=Object.create(o),n.pressed={},n.released={},n.wheeldelta={x:0,y:0,d:0},n.x=-1e4,n.y=-1e4,n.xdelta=0,n.ydelta=0,n.xwheel=0,n.ywheel=0,n.wheel=0;var l=!1,c=!1;n.pointerlock=function(e){if(!arguments.length)return l;!(l=!!e)&&c&&n.exitpointerlock()},n.ispointerlocked=function(){return c},n.exitpointerlock=function(){c&&t[u]()};var s,f={},x={};n.enable=function(){f.enable(),x.enable()},n.disable=function(){f.disable(),x.disable()},n.isenabled=function(){return f.isenabled()},(s={})[h]=function(){c=document[m]==t},s[v]=function(){console.log("error obtaining pointerlock")},w(f,document,s),w(x,e,{mousedown:function(i){l&&!c&&t[d]();var a=o[i.which];n[a]=!0,n.steps&&(n.pressed[a]=!0),n.x=i.clientX-(e.offsetLeft||0),n.y=i.clientY-(e.offsetTop||0),y("down",i.which,a,i)},mouseup:function(t){var i=o[t.which];n[i]=!1,n.steps&&(n.released[i]=!0),n.x=t.clientX-(e.offsetLeft||0),n.y=t.clientY-(e.offsetTop||0),y("up",t.which,i,t)},mousemove:function(t){n.x=t.clientX-(e.offsetLeft||0),n.y=t.clientY-(e.offsetTop||0),n.steps&&(n.xdelta+=+t.movementX===t.movementX?t.movementX:+t.mozMovementX===t.mozMovementX?t.mozMovementX:+t.webkitMovementX===t.webkitMovementX?t.webkitMovementX:0,n.ydelta+=+t.movementY===t.movementY?t.movementY:+t.mozMovementY===t.mozMovementY?t.mozMovementY:+t.webkitMovementY===t.webkitMovementY?t.webkitMovementY:0),y("move",n.x,n.y,t)},wheel:function(e){"firefox"==r?(n.xwheel=24*-e.deltaX,n.ywheel=24*-e.deltaY,n.wheel=24*-e.deltaY):(n.xwheel=e.wheelDeltaX,n.ywheel=e.wheelDeltaY,n.wheel=e.wheelDelta),n.wheeldelta.x+=n.xwheel,n.wheeldelta.y+=n.ywheel,n.wheeldelta.d+=n.wheel,y("wheel",n.wheel,n.xwheel,n.ywheel,e)}}),n.stepclear=function(){n.pressed={},n.released={},n.wheeldelta={x:0,y:0,d:0},n.xdelta=n.ydelta=0},n.steps=!1;var y=p(n,{wheel:[],down:[],up:[],move:[]})},g=function(e){var n=this
;if(!(n instanceof g))throw"Bad instantiation of object nimble.Touch";function t(e,t,o){var a=this;i[o]=a,n.steps&&n.pressed.push(a),a.x=e,a.y=t,a.identifier=o,a.ended=!1,a._move=function(e,n){a.x=e,a.y=n,r("move",a.x,a.y)},a._end=function(e,t,l){a.x=e,a.y=t,delete i[o],a.ended=!0,n.steps&&n.released.push(a),r("end",a.x,a.y,l)};var r=p(a,{move:[],end:[]})}e=e||window;var i={};n.pressed=[],n.released=[],w(n,e,{touchstart:function(n){n.preventDefault();for(var i=e.offsetLeft||0,a=e.offsetTop,r=n.changedTouches,l=[],c=r.length,s=0;s<c;s++)l.push(new t(r[s].clientX-i,r[s].clientY-a,r[s].identifier));o("start",l,n)},touchmove:function(n){n.preventDefault();for(var t=e.offsetLeft||0,a=e.offsetTop,r=n.changedTouches,l=[],c=r.length,s=0;s<c;s++)l.push(i[r[s].identifier]),i[r[s].identifier]._move(r[s].clientX-t,r[s].clientY-a);o("move",l,n)},touchend:function(n){n.preventDefault();for(var t=e.offsetLeft||0,a=e.offsetTop,r=n.changedTouches,l=[],c=r.length,s=0;s<c;s++)l.push(i[r[s].identifier]),i[r[s].identifier]._end(r[s].clientX-t,r[s].clientY-a,!1);o("end",l,!1,n)},touchcancel:function(n){n.preventDefault();for(var t=e.offsetLeft||0,a=e.offsetTop,r=n.changedTouches,l=[],c=r.length,s=0;s<c;s++)l.push(i[r[s].identifier]),i[r[s].identifier]._end(r[s].clientX-t,r[s].clientY-a,!0);o("end",l,!0,n)}}),n.clear=function(){for(var e in i)i[e]._end(null,null,2)},n.stepclear=function(){n.pressed=[],n.released=[]},n.steps=!1;var o=p(n,{start:[],move:[],end:[]})},k=function(e){var n=this;if(!(n instanceof k))throw"Bad instantiation of object nimble.Orientation";e=e||window,n.alpha=0,n.beta=0,n.gamma=0,n.xgrav=0,n.ygrav=0,n.zgrav=0,n.xacc=0,n.yacc=0,n.zacc=0,n.xorient={x:0,y:0,z:0},n.yorient={x:0,y:0,z:0},n.zorient={x:0,y:0,z:0},n.xreal={x:0,y:0,z:0},n.yreal={x:0,y:0,z:0},n.zreal={x:0,y:0,z:0};var t=Math.PI/180,i=Math.cos,o=Math.sin;w(n,e,{deviceorientation:function(e){n.alpha=e.alpha,n.beta=e.beta,n.gamma=e.gamma;var r=n.alpha*t,l=n.beta*t,c=n.gamma*t,s=i(r),f=o(r),d=i(l),u=o(l),m=i(c),h=o(c);n.xorient.x=m*d,n.yorient.x=m*u*f-s*h,n.zorient.x=h*f+m*s*u,n.xorient.y=d*h,n.yorient.y=m*s+h*u*f,n.zorient.y=s*h*u-m*f,n.xorient.z=-u,n.yorient.z=d*f,n.zorient.z=d*s,f=-f,u=-u,h=-h,n.xreal.x=d*m,n.yreal.x=-d*h,n.zreal.x=u,n.xreal.y=s*h+m*f*u,n.yreal.y=s*m-f*u*h,n.zreal.y=-d*f,n.xreal.z=f*h-s*m*u,n.yreal.z=m*f+s*u*h,n.zreal.z=s*d,a("rotate",n.alpha,n.beta,n.gamma,e)},devicemotion:function(e){var t,i;t=e.accelerationIncludingGravity,null===(i=e.acceleration).x&&null===t.x||(null===t.x&&(t={x:i.x+9.81*n.zreal.x,y:i.y+9.81*n.zreal.y,z:i.z+9.81*n.zreal.z}),null===e.acceleration.x&&(i={x:t.x-9.81*n.zreal.x,y:t.y-9.81*n.zreal.y,z:t.z-9.81*n.zreal.z}),n.xgrav=t.x,n.ygrav=t.y,n.zgrav=t.z,n.xacc=i.x,n.yacc=i.y,n.zacc=i.z,a("move",n.xacc,n.yacc,n.zacc,e))}}),n.stepclear=function(){},n.steps=!1;var a=p(n,{rotate:[],move:[]})};return{Canvas:x,Steps:y,Keyboard:b,Mouse:z,Touch:g,Orientation:k}};